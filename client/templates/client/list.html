<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div class="container">
  <div class="jumbotron">
    <div class="row text-center">
      <div class="col-lg-3"></div>
      <div class="col-lg-3"></div>
      <div class="col-lg-3"></div>
      <div class="col-lg-3 create"><a href="#back" class="pad-right"><i class="fas fa-arrow-left"></i></a><a href="#create"><i class="fas fa-plus"></i></a></div>
      <div class="row text-center contents">
        <div class="col-lg-12">
          <table class="table table-hover">
            <tbody>
            <tr>
              <tr>
                <th><a href="/list{{ parent }}" class="black-link"><i class="far fa-folder"></i></a>
                </th>
                <td>
                  <a href="/list{{ parent }}" class="black-link">
                    <h6>..</h6>
                  </a>
                </td>
                <td></td>
                <td></td>
              </tr>
            </tr>
            {% for item in items %}
            {% if item.is_directory %}
              <tr>
                <th><a href="/list{{item.path}}" class="black-link"><i class="far fa-folder"></i></a>
                </th>
                <td>
                  <a href="/list{{item.path}}" class="black-link">
                    <h6>{{ item.name }}</h6>
                  </a>
                </td>
                <td>
                  <h6>{{ item.size }}</h6>
                </td>
                <td>
                  <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}<input type="text" hidden="hidden" name="path" value="{{ item.path }}">
                    {% csrf_token %}<input type="submit" value="삭제" />
                  </form>
                </td>
              </tr>
            {% endif %}
            {% endfor %}
            {% for item in items %}
            {% if not item.is_directory %}
              <tr>
                <th><i class="far fa-file-code"></i></th>
                <td>
                  <a href="/download{{item.path}}" class="black-link">
                    <h6>{{ item.name }}</h6>
                  </a>
                </td>
                <td>
                  <h6>{{ item.size }}</h6>
                </td>
                <td>
                  <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}<input type="text" hidden="hidden" name="path" value="{{ item.path }}">
                    {% csrf_token %}<input type="submit" value="삭제" />
                  </form>
                </td>
              </tr>
            {% endif %}
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <form name="create-directory-form" method="post">
    <table>
        <tr>
            <th>directory : </th>
            <td>{% csrf_token %} <input type="text" name="name"> {% csrf_token %} <input type="submit" value="폴더 생성"></td>
        </tr>
     </table>
</form>
<form method="post" enctype="multipart/form-data">
    File:
    {% csrf_token %}<input type="text" hidden="hidden" name="path" value="{{ path }}">
    {% csrf_token %}<input type="file" name="filedata"/>
    {% csrf_token %}<input type="submit" value="UPLOAD" />
</form>
<a href="/logout/">로그아웃</a>
</body>
</html>


<style>
body {
  background: #59a0b6;
}

.container {
  margin-top: 2rem;
}

.col-lg-4 {
  padding-right: 10px;
  padding-left: 10px;
}

.jumbotron {
  padding: 0rem;
  background: #f9f9f9;
  box-shadow: 16px 16px 5px 0px rgba(0, 0, 0, 0.1);
}

.table td,
.table th {
  border-top: none;
}

.table thead th {
  border-bottom: none;
}

.fa,
.far,
.fas {
  font-size: 1.3rem;
}

.fa-edit:before {
  content: "\f044";
  padding-right: 0.4rem;
  font-size: 1rem;
}

.fa-arrows-alt-v:before {
  content: "\f338";
  padding-right: 0.4rem;
  font-size: 1rem;
}

.fa-trash-alt:before {
  content: "\f2ed";
  padding-left: 0.3rem;
  font-size: 1rem;
}

.create {
  text-align: right;
  padding-right: 2rem;
}

.contents {
  padding: 1.5rem 2rem;
}

.black-link {
  color: #373a3c;
  text-decoration: none;
}

.black-link:hover {
  color: #373a3c;
  text-decoration: none;
}
.pad-right {
  padding-right: 1rem;
}

</style>


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script type="text/javascript">

async function loadDir(id, event){
    this.files = [];
    if(id==undefined)
        id='';

     token = '{{ request.session.token }}'
    var data =  await $.ajax({
                    url:'/api/files/listfolder/?dir='+id,
                    method: 'GET',
                    dataType: 'json',
                    beforeSend: function(xhr){
                        xhr.setRequestHeader("Authorization","Bearer "+token);
                    }
                    });
    this.files=data.items
}

var app = new Vue({
    el: '#app',
    delimiters: ['[[',']]'],
    data : {
        message: '안녕하세요 Vue!',
        files: [],
        location: [],
    },
    mounted: loadDir,
    methods: {
        loadDir: loadDir
    }
});

new Vue({
	el: "#container",
	delimiters: ['[[',']]'],
	data: {
		uploads: [],
		colors: ["#24bddf", "#5fcc9c", "#6a65d8"]
	},
	methods: {
		getRandomColor() {
			const randomIndex = Math.floor(Math.random() * 2);
			return this.colors[randomIndex];
		},
		removeUpload(index) {
			clearInterval(this.uploads[index].progressTimer);
			this.uploads.splice(index, 1);
		},
		openFilePicker() {
			this.$refs.filepicker.click();
		},
		uploadFile() {
			const input = this.$refs.filepicker;
			const file = input.files[0];

			const upload = {
				id: this.uploads.length + 1,
				name: file.name,
				size: this.getFileSize(file.size),
				progress: "0%",
				ext: file.name.substring(file.name.lastIndexOf(".") + 1, file.name.length),
				progressTimer: null,
				color: this.getRandomColor()
			};

			this.uploads.push(upload);
			const timer = setInterval(this.updateProgress, 300, upload.id);
			upload.progressTimer = timer;
		},
		getFileSize(size) {
			if (size < 1000000) return `${Math.ceil(size / 1024)} kb`;
			else if (size >= 1000000) return `${Math.ceil(size / 1024000)} mb`;
		},
		updateProgress(id) {
			const index = id - 1;
			const progress = Number.parseInt(
				this.uploads[index].progress.replace("%", "")
			);

			this.$set(this.uploads[index], "progress", `${progress + 10}%`);
			if (progress + 10 === 100) clearInterval(this.uploads[index].progressTimer);
		}
	}
});

</script>